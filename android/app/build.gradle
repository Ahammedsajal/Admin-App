plugins {
    id "com.android.application"
    id "org.jetbrains.kotlin.android"      // ← modern id
    id "com.google.gms.google-services"
    id "dev.flutter.flutter-gradle-plugin"
}

def localProps = new Properties()
def localPropsFile    = rootProject.file('local.properties') 
if (localPropsFile.exists()) {
    localPropsFile.withReader('UTF-8') { localProps.load(it) }
}
def flutterVersionCode  = localProps['flutter.versionCode'] ?: '6'
def flutterVersionName  = localProps['flutter.versionName'] ?: '4.3.0'

def keystoreProps = new Properties()
def ksFile = rootProject.file('key.properties')
if (ksFile.exists()) ksFile.withInputStream { keystoreProps.load(it) }

android {
    namespace       "com.the8thmiracle.customer"
    compileSdk      34

    defaultConfig {
        applicationId       "com.the8thmiracle.customer"
        minSdk              23
        targetSdk           34
        versionCode         flutterVersionCode.toInteger()
        versionName         flutterVersionName
        multiDexEnabled     true
    }

    compileOptions {
        coreLibraryDesugaringEnabled true
        sourceCompatibility JavaVersion.VERSION_17
        targetCompatibility JavaVersion.VERSION_17
    }

    sourceSets {
        main.java.srcDirs += 'src/main/kotlin'
    }

    signingConfigs {
        release {
            keyAlias         keystoreProps['keyAlias']
            keyPassword      keystoreProps['keyPassword']
            storeFile        keystoreProps['storeFile'] ? file(keystoreProps['storeFile']) : null
            storePassword    keystoreProps['storePassword']
        }
    }

    buildTypes {
        release {
            signingConfig signingConfigs.release
            // enable R8 / ProGuard here if you need to
        }
    }
}

/* Kotlin 2.x tool-chain –> generate Java-17 byte-code */
kotlin {
    jvmToolchain(17)
}

dependencies {
    coreLibraryDesugaring 'com.android.tools:desugar_jdk_libs:2.1.4'
    implementation platform('com.google.firebase:firebase-bom:33.1.0')
    implementation 'com.android.support:multidex:2.0.1'
}

flutter {
    source '../..'
}
